<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecture Player | JEE Matrix</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Merriweather', 'serif'],
                    },
                    colors: { background: '#020617' },
                    animation: { 'fade-in': 'fadeIn 0.5s ease-out forwards' },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #020617;
            color: #f8fafc;
            background-image: linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            min-height: 100vh;
        }

        /* Video Container (16:9) */
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            background: #000;
            border-radius: 16px;
            box-shadow: 0 20px 50px -12px rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .video-container iframe {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Notes Specific Styles */
        .notes-content p, .notes-content li {
            font-family: 'Merriweather', serif;
            color: #cbd5e1; /* slate-300 */
            line-height: 1.8;
            margin-bottom: 1rem;
        }
        .notes-content h2 {
            font-family: 'Inter', sans-serif;
            color: #60a5fa; /* blue-400 */
            font-weight: 700;
            font-size: 1.5rem;
            margin-top: 3rem;
            margin-bottom: 1rem;
            border-left: 4px solid #3b82f6;
            padding-left: 1rem;
        }
        .notes-content h3 {
            font-family: 'Inter', sans-serif;
            color: #f8fafc; /* white */
            font-weight: 600;
            font-size: 1.25rem;
            margin-top: 2rem;
            margin-bottom: 0.75rem;
        }
        .notes-content strong { color: #fff; }
        .notes-content ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1.5rem; }
        .notes-content ol { list-style-type: decimal; padding-left: 1.5rem; margin-bottom: 1.5rem; }
        
        .formula-box {
            background-color: #1e293b; /* slate-800 */
            border: 1px solid rgba(255,255,255,0.1);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            text-align: center;
            font-family: 'Inter', sans-serif;
            overflow-x: auto;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .note-highlight {
            background-color: rgba(59, 130, 246, 0.1); /* blue-500/10 */
            border-left: 4px solid #3b82f6; /* blue-500 */
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
            font-style: italic;
        }

        /* --- CHAPTER 3 ANIMATIONS (Ported) --- */
        .diagram-container {
            background-color: #0f172a;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 30px;
            margin: 2rem 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            text-align: center;
        }
        .caption {
            margin-top: 15px;
            font-size: 0.85rem;
            color: #94a3b8;
            font-family: 'Inter', sans-serif;
            font-weight: bold;
        }

        /* 1. Electron Drift Animation */
        .wire-tube {
            width: 300px;
            height: 60px;
            background: linear-gradient(180deg, #374151, #1f2937);
            border-radius: 30px;
            position: relative;
            border: 2px solid #6b7280;
            overflow: hidden;
        }
        .electron-dot {
            width: 8px; height: 8px;
            background-color: #facc15; /* Yellow */
            border-radius: 50%;
            position: absolute;
            box-shadow: 0 0 8px #facc15;
        }
        @keyframes driftMove {
            0% { transform: translateX(0px) translateY(0px); opacity: 0;}
            10% { opacity: 1; }
            25% { transform: translateX(50px) translateY(-5px); }
            50% { transform: translateX(100px) translateY(5px); }
            75% { transform: translateX(150px) translateY(-5px); }
            90% { opacity: 1; }
            100% { transform: translateX(200px) translateY(0px); opacity: 0;}
        }
        .d1 { top: 25px; animation: driftMove 4s infinite linear 0s; }
        .d2 { top: 10px; animation: driftMove 4s infinite linear 1s; }
        .d3 { top: 40px; animation: driftMove 4s infinite linear 2s; }
        .e-field-arrow {
            position: absolute; bottom: 5px; left: 50%;
            transform: translateX(-50%);
            color: white; font-size: 10px; font-family: sans-serif;
            display: flex; align-items: center; gap: 5px;
        }
        .e-field-arrow::before { content: '← E Field'; }

        /* 2. Kirchhoff's Junction */
        .junction-box { width: 200px; height: 200px; position: relative; }
        .path {
            position: absolute; background-color: #4b5563;
            height: 4px; width: 100px; top: 50%; left: 50%;
            transform-origin: left;
        }
        .p1 { transform: rotate(0deg); }
        .p2 { transform: rotate(120deg); }
        .p3 { transform: rotate(240deg); }
        .current-particle {
            width: 8px; height: 8px;
            background-color: #facc15;
            border-radius: 50%;
            position: absolute;
            top: 50%; left: 50%;
            margin-top: -4px; margin-left: -4px;
        }
        .in1 { animation: flowIn 2s infinite linear; transform-origin: center; }
        .in2 { animation: flowIn 2s infinite linear 0.5s; transform: rotate(120deg); }
        .out1 { animation: flowOut 2s infinite linear; transform: rotate(240deg); }
        @keyframes flowIn {
            0% { transform: rotate(0deg) translateX(100px); opacity: 0; }
            50% { transform: rotate(0deg) translateX(50px); opacity: 1; }
            100% { transform: rotate(0deg) translateX(0px); opacity: 1; }
        }
        @keyframes flowOut {
            0% { transform: rotate(240deg) translateX(0px); opacity: 1; }
            100% { transform: rotate(240deg) translateX(100px); opacity: 0; }
        }

        /* 3. Wheatstone Bridge */
        .bridge-container { width: 200px; height: 200px; position: relative; }
        .resistor {
            width: 60px; height: 8px;
            background: repeating-linear-gradient(45deg, #60a5fa, #60a5fa 5px, #1e40af 5px, #1e40af 10px);
            position: absolute; border-radius: 4px;
        }
        .br1 { top: 40px; left: 20px; transform: rotate(45deg); }
        .br2 { top: 40px; right: 20px; transform: rotate(-45deg); }
        .br3 { bottom: 40px; left: 20px; transform: rotate(-45deg); }
        .br4 { bottom: 40px; right: 20px; transform: rotate(45deg); }
        .galv-center {
            width: 30px; height: 30px;
            border: 2px solid white; border-radius: 50%;
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            display: flex; align-items: center; justify-content: center;
            font-size: 14px; font-weight: bold; color: white;
            background: #1f2937; z-index: 2;
        }
        .wire-vertical {
            position: absolute; width: 2px; height: 100%;
            background-color: #9ca3af; left: 50%; top: 0;
        }
        .pulse-signal {
            position: absolute; top: 50%; left: 50%;
            width: 10px; height: 10px;
            background-color: #10b981;
            border-radius: 50%;
            transform: translate(-50%, -50%);
            opacity: 0;
            animation: pulseCheck 3s infinite;
        }
        @keyframes pulseCheck {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.5); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(2); }
        }

        /* Quiz Specifics */
        .quiz-option {
            background: #1e293b;
            border: 1px solid rgba(255,255,255,0.1);
            padding: 1rem 1.25rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .quiz-option:hover { background: #334155; }
        .quiz-option.selected { background: rgba(96, 165, 250, 0.2); border-color: #60a5fa; }
        .quiz-circle { width: 20px; height: 20px; border: 2px solid #64748b; border-radius: 50%; flex-shrink: 0; }
        .quiz-option.selected .quiz-circle { border-color: #60a5fa; background: #60a5fa; }

        /* Pie Chart */
        .pie-chart {
            width: 120px; height: 120px; border-radius: 50%;
            margin: 15px 0;
            background: conic-gradient(#22c55e 0deg, #ef4444 0deg);
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
        }
        .pie-inner {
            position: absolute; top: 15px; left: 15px;
            width: 90px; height: 90px;
            background: #1e293b; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; color: #fff;
        }

        /* Graph Container (Horizontal Scroll Fix) */
        .graph-container {
            height: 140px;
            display: flex;
            align-items: flex-end;
            gap: 8px;
            padding-bottom: 5px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            margin-top: 20px;
            overflow-x: auto;
            width: 100%;
            padding-right: 10px;
        }
        .graph-bar-group {
            flex: 0 0 auto;
            min-width: 45px;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
            justify-content: flex-end;
        }
        .graph-bar {
            width: 100%;
            background: linear-gradient(to top, #3b82f6, #60a5fa);
            border-radius: 4px 4px 0 0;
            transition: height 1s ease-out;
            position: relative;
            min-height: 4px;
        }
        .graph-label {
            margin-top: 8px; font-size: 0.65rem; color: #94a3b8;
            text-align: center; width: 100%; white-space: nowrap;
            overflow: hidden; text-overflow: ellipsis;
        }
        .graph-value {
            position: absolute; top: -18px; left: 50%;
            transform: translateX(-50%);
            font-size: 0.65rem; color: #fff; font-weight: bold;
        }
        .bar-bg { background: rgba(255,255,255,0.05); height: 6px; border-radius: 99px; overflow: hidden; }
        .bar-fill { height: 100%; background: #60a5fa; transition: width 1s ease; }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">

    <header class="h-16 border-b border-white/5 bg-[#020617]/90 backdrop-blur-md flex items-center justify-between px-6 z-[100] flex-shrink-0 relative">
        <div class="flex items-center gap-4">
            <a href="physics.html" class="w-10 h-10 rounded-full hover:bg-white/5 flex items-center justify-center text-slate-400 hover:text-white transition-all group cursor-pointer" title="Back to Chapters">
                <svg class="w-5 h-5 group-hover:-translate-x-1 transition-transform pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
            </a>
            <div>
                <p class="text-[10px] uppercase tracking-widest text-blue-400 font-bold" id="header-subtitle">Now Watching</p>
                <h1 id="header-title" class="text-sm md:text-base font-bold text-white truncate max-w-[200px] md:max-w-md">Current Electricity</h1>
            </div>
        </div>
        <div class="flex items-center gap-3">
            <button id="quiz-back-btn" onclick="exitQuiz()" class="hidden px-3 py-1.5 text-xs font-bold bg-white/10 hover:bg-white/20 rounded-lg text-white transition-colors border border-white/10">
                Back to Lecture
            </button>
            <span class="text-xs text-slate-500 font-medium hidden md:block" id="save-status">Tracking Progress...</span>
            <div class="flex items-center gap-2 bg-slate-800 px-3 py-1 rounded-full border border-white/10">
                 <div class="w-2 h-2 rounded-full bg-orange-500 animate-pulse" id="live-indicator"></div>
                 <span class="text-xs font-bold text-white" id="live-percent">0%</span>
            </div>
        </div>
        <div id="visual-progress" class="absolute bottom-0 left-0 h-1 bg-gradient-to-r from-blue-500 to-cyan-500 transition-all duration-700 ease-in-out shadow-[0_0_10px_rgba(96,165,250,0.5)]" style="width: 0%"></div>
    </header>

    <main class="flex-grow overflow-y-auto p-4 md:p-8 flex flex-col items-center relative">
        
        <div id="content-view" class="w-full max-w-4xl animate-fade-in pb-20">
            
            <div class="video-container mb-6">
                <iframe id="main-player" src="https://www.youtube.com/embed/ANz7YYAZzrM?autoplay=0&rel=0&modestbranding=1" title="Video Player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>

            <div class="flex flex-col md:flex-row items-center justify-between gap-4 p-6 bg-[#0f172a] border border-white/5 rounded-2xl shadow-lg mb-10">
                <div class="w-full md:w-auto">
                    <h2 id="video-title" class="text-2xl font-bold text-white mb-1">Current Electricity</h2>
                    <p class="text-slate-400 text-sm">Physics • Class 12 • Chapter 3</p>
                </div>
                <div class="flex items-center gap-3 w-full md:w-auto">
                    <button id="mark-done-btn" onclick="toggleStatus()" class="flex-1 md:flex-none flex items-center justify-center gap-2 px-5 py-3 rounded-xl bg-slate-800 border border-slate-600 transition-all text-sm font-semibold text-slate-200 group cursor-not-allowed opacity-50">
                        <div class="w-5 h-5 rounded-full border-2 border-slate-400 group-hover:border-white flex items-center justify-center">
                            <svg class="w-3 h-3 text-white opacity-0 transition-opacity check-icon" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg>
                        </div>
                        <span class="btn-text" id="mark-btn-text">Locked (Studying...)</span>
                    </button>
                    
                    <button onclick="startQuiz()" class="flex-1 md:flex-none flex items-center justify-center gap-2 px-6 py-3 rounded-xl bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-500 hover:to-cyan-500 text-white font-bold shadow-lg shadow-blue-500/20 hover:shadow-blue-500/40 hover:-translate-y-0.5 transition-all group">
                        <span>Take Test</span>
                        <svg class="w-5 h-5 group-hover:rotate-6 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                    </button>
                </div>
            </div>

            <div id="detailed-notes" class="notes-content">
                <div class="flex items-center gap-3 mb-6">
                    <div class="h-8 w-1 bg-blue-500 rounded-full"></div>
                    <h2 class="!m-0 !border-0 !p-0 text-3xl text-white">Detailed Physics Notes</h2>
                </div>
                
                <p class="text-slate-400 italic mb-8">Comprehensive notes based on NCERT Class 12 Physics - Chapter 3</p>

                <section id="intro">
                    <h2>1. Introduction & Electric Current</h2>
                    <p><strong>Electric Current</strong> is the flow of electric charges. While phenomena like lightning involve transient currents, everyday devices like torches and clocks rely on steady electric currents.</p>
                    
                    <h3>Electric Current (I)</h3>
                    <p>Imagine a small area held normal to the direction of flow of charges. Current is defined as the net charge passing through this area per unit time.</p>
                    
                    <div class="formula-box">
                        $$ I = \frac{q}{t} \quad \text{(Steady Current)} $$
                        $$ I(t) = \lim_{\Delta t \to 0} \frac{\Delta Q}{\Delta t} \quad \text{(Instantaneous Current)} $$
                    </div>
                    
                    <ul>
                        <li><strong>Unit:</strong> Ampere (A). 1 Ampere = 1 Coulomb per second.</li>
                        <li><strong>Currents in Conductors:</strong> In metals, valence electrons are not attached to individual nuclei and are free to move throughout the volume. Without an electric field, their motion is random (thermal motion) with no net transport. When an electric field is applied, these electrons drift, creating a current.</li>
                    </ul>
                </section>

                <section id="ohm">
                    <h2>2. Ohm's Law & Resistance</h2>
                    <p>Discovered by G.S. Ohm in 1828. It states that for a conductor, the voltage \( V \) is proportional to the current \( I \) flowing through it (provided physical conditions like temperature remain constant).</p>

                    <div class="formula-box">
                        $$ V \propto I \Rightarrow V = R I $$
                    </div>
                    <p>Where \( R \) is the <strong>Resistance</strong> of the conductor. The SI unit of resistance is the Ohm (\( \Omega \)).</p>

                    <h3>Dependence on Dimensions</h3>
                    <p>Resistance depends on the material and dimensions of the conductor:</p>
                    <ul>
                        <li><strong>Length (\( l \)):</strong> \( R \propto l \) (Longer wire = Higher resistance).</li>
                        <li><strong>Area (\( A \)):</strong> \( R \propto 1/A \) (Thicker wire = Lower resistance).</li>
                    </ul>
                    <div class="formula-box">
                        $$ R = \rho \frac{l}{A} $$
                    </div>
                    <p>Here, \( \rho \) (rho) is the <strong>Electrical Resistivity</strong>, a characteristic property of the material.</p>

                    <h3>Current Density (\( \mathbf{j} \))</h3>
                    <p>Current density is current per unit area (\( j = I/A \)). Ohm's law can be expressed in vector form using Conductivity (\( \sigma = 1/\rho \)):</p>
                    <div class="formula-box">
                        $$ \mathbf{E} = \mathbf{j} \rho \quad \text{or} \quad \mathbf{j} = \sigma \mathbf{E} $$
                    </div>
                </section>

                <section id="drift">
                    <h2>3. Drift of Electrons & Origin of Resistivity</h2>
                    <p>Electrons in a conductor are in constant thermal motion. In the presence of an electric field, they accelerate but constantly collide with fixed ions. This results in a small net velocity opposite to the field, known as <strong>Drift Velocity</strong>.</p>

                    <div class="diagram-container">
                        <div class="wire-tube">
                            <div class="e-field-arrow"></div>
                            <div class="electron-dot d1"></div>
                            <div class="electron-dot d2"></div>
                            <div class="electron-dot d3"></div>
                        </div>
                        <div class="caption">
                            <strong>Figure 3.1:</strong> Electrons drifting to the right (opposite to E-field) due to collisions.
                        </div>
                    </div>

                    <h3>Drift Velocity Formula</h3>
                    <p>The time between two successive collisions is called <strong>Relaxation Time (\( \tau \))</strong>. The average velocity is:</p>
                    <div class="formula-box">
                        $$ \mathbf{v}_d = -\frac{e \mathbf{E}}{m} \tau $$
                    </div>

                    <h3>Relation to Current and Resistivity</h3>
                    <p>If \( n \) is the number density of free electrons:</p>
                    <div class="formula-box">
                        $$ I = n e A |v_d| \quad \text{and} \quad j = n e v_d $$
                    </div>
                    <p>Substituting \( v_d \) into Ohm's law gives us the microscopic formula for resistivity:</p>
                    <div class="formula-box">
                        $$ \rho = \frac{m}{n e^2 \tau} \quad \text{and} \quad \sigma = \frac{n e^2 \tau}{m} $$
                    </div>

                    <h3>Mobility (\( \mu \))</h3>
                    <p>Defined as the magnitude of drift velocity per unit electric field.</p>
                    <div class="formula-box">
                        $$ \mu = \frac{|v_d|}{E} = \frac{e\tau}{m} $$
                    </div>
                </section>

                <section id="limitations">
                    <h2>4. Limitations of Ohm's Law</h2>
                    <p>Materials that strictly follow \( V=IR \) are called "Ohmic". However, many devices deviate from this behavior:</p>
                    <ol>
                        <li><strong>Non-linear V-I Relationship:</strong> The graph of V vs I is not a straight line (e.g., heating in a bulb filament).</li>
                        <li><strong>Direction Dependence:</strong> Current flows differently if voltage polarity is reversed (e.g., Semiconductor Diodes).</li>
                        <li><strong>Non-unique Relationship:</strong> A single current value can correspond to multiple voltage values (e.g., GaAs).</li>
                    </ol>
                </section>

                <section id="temp">
                    <h2>5. Temperature Dependence of Resistivity</h2>
                    <p>Resistivity changes with temperature.</p>
                    <ul>
                        <li><strong>Metals:</strong> Resistivity increases with temperature. As temperature rises, ions vibrate more, increasing collision frequency (decreasing \( \tau \)).
                            <div class="formula-box">$$ \rho_T = \rho_0 [1 + \alpha(T - T_0)] $$</div>
                            Where \( \alpha \) is the temperature coefficient of resistivity.
                        </li>
                        <li><strong>Semiconductors & Insulators:</strong> Resistivity <strong>decreases</strong> with temperature. This is because the number density of free electrons \( n \) increases significantly with heat, which outweighs the decrease in \( \tau \).</li>
                    </ul>
                </section>

                <section id="energy">
                    <h2>6. Electrical Energy & Power</h2>
                    <p>Consider a current \( I \) flowing through a resistor \( R \) across a potential difference \( V \). The electric potential energy lost by charges is dissipated as heat (Joule Heating).</p>
                    
                    <h3>Power Dissipated (P)</h3>
                    <p>Power is the rate at which energy is dissipated:</p>
                    <div class="formula-box">
                        $$ P = V I = I^2 R = \frac{V^2}{R} $$
                    </div>

                    <h3>Power Transmission</h3>
                    <p>Power cables have finite resistance \( R_c \). To minimize power loss (\( P_c = I^2 R_c \)) during transmission over long distances, electricity is transmitted at very high voltages. High voltage implies low current for the same power delivered, thus drastically reducing \( I^2 R \) losses.</p>
                </section>

                <section id="cells">
                    <h2>7. Cells, EMF, Internal Resistance</h2>
                    <p>An electrolytic cell maintains a steady current using chemical reactions.</p>
                    <ul>
                        <li><strong>EMF (\( \varepsilon \)):</strong> The potential difference between the two terminals when <strong>no current</strong> is drawn (open circuit). It is the work done per unit charge by the non-electrostatic forces.</li>
                        <li><strong>Terminal Voltage (\( V \)):</strong> The potential difference when current \( I \) flows.</li>
                        <li><strong>Internal Resistance (\( r \)):</strong> The resistance offered by the electrolyte inside the cell.</li>
                    </ul>
                    <div class="formula-box">
                        $$ V = \varepsilon - I r $$
                    </div>

                    <h3>Combination of Cells</h3>
                    <p><strong>Series:</strong> Cells connected end-to-end. EMFs add up; internal resistances add up.</p>
                    <div class="formula-box">$$ \varepsilon_{eq} = \varepsilon_1 + \varepsilon_2 + \dots \quad r_{eq} = r_1 + r_2 + \dots $$</div>
                    
                    <p><strong>Parallel:</strong> Positive terminals connected together, negatives together.</p>
                    <div class="formula-box">
                        $$ \frac{\varepsilon_{eq}}{r_{eq}} = \frac{\varepsilon_1}{r_1} + \frac{\varepsilon_2}{r_2} + \dots \quad \frac{1}{r_{eq}} = \frac{1}{r_1} + \frac{1}{r_2} + \dots $$
                    </div>
                </section>

                <section id="kirchhoff">
                    <h2>8. Kirchhoff's Rules</h2>
                    <p>These rules allow analysis of complex circuits that cannot be reduced to simple series/parallel combinations.</p>

                    <div class="diagram-container">
                        <div class="junction-box">
                            <div class="path p1"></div>
                            <div class="path p2"></div>
                            <div class="path p3"></div>
                            <div class="current-particle in1"></div>
                            <div class="current-particle in2"></div>
                            <div class="current-particle out1"></div>
                        </div>
                        <div class="caption">
                            <strong>Figure 3.2:</strong> Junction Rule. Current entering equals current leaving.
                        </div>
                    </div>

                    <h3>1. Junction Rule (Current Law)</h3>
                    <p>At any junction, the sum of currents entering equals the sum of currents leaving. This is based on the <strong>Conservation of Charge</strong>.</p>
                    <div class="formula-box">$$ \sum I_{in} = \sum I_{out} $$</div>

                    <h3>2. Loop Rule (Voltage Law)</h3>
                    <p>The algebraic sum of changes in potential around any closed loop is zero. This is based on the <strong>Conservation of Energy</strong>.</p>
                    <div class="formula-box">$$ \sum \Delta V = 0 $$</div>
                </section>

                <section id="wheatstone">
                    <h2>9. Wheatstone Bridge</h2>
                    <p>A specific arrangement of 4 resistors forming a diamond shape, used to measure an unknown resistance precisely.</p>

                    <div class="diagram-container">
                        <div class="bridge-container">
                            <div class="resistor br1"></div>
                            <div class="resistor br2"></div>
                            <div class="resistor br3"></div>
                            <div class="resistor br4"></div>
                            <div class="wire-vertical"></div>
                            <div class="galv-center">G</div>
                            <div class="pulse-signal"></div>
                        </div>
                        <div class="caption">
                            <strong>Figure 3.3:</strong> Balanced Wheatstone Bridge. No current flows through G.
                        </div>
                    </div>

                    <h3>Balanced Condition</h3>
                    <p>The bridge is balanced when the potential difference across the galvanometer is zero (no current flows, \( I_g = 0 \)). This happens when:</p>
                    <div class="formula-box">
                        $$ \frac{R_2}{R_1} = \frac{R_4}{R_3} $$
                    </div>
                    <p>This principle is used in the <strong>Meter Bridge</strong> to determine unknown resistance.</p>
                </section>
                <div class="mt-10 pt-6 border-t border-white/10 text-center text-slate-500 text-sm">
                    BRO YOU CAN AND YOU WILL ⚡
                </div>
            </div>
        </div>

        <div id="quiz-view" class="w-full max-w-4xl flex-col items-center animate-fade-in hidden pb-20">
            <div class="w-full bg-[#1e293b] border border-white/5 rounded-2xl p-4 mb-6 flex justify-between items-center shadow-lg">
                <h2 class="text-xl font-bold text-white">Physics Master Quiz</h2>
                <div class="px-3 py-1 bg-black/30 rounded-lg border border-white/10 font-mono text-lg text-white" id="timer">15:00</div>
            </div>

            <div id="screen-start" class="w-full bg-[#0f172a] border border-white/5 rounded-2xl p-8 text-center shadow-lg flex flex-col items-center">
                <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-blue-600 to-cyan-600 flex items-center justify-center mb-6 shadow-lg shadow-blue-500/20">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                </div>
                <h2 class="text-3xl font-bold text-white mb-2">Practice Quiz</h2>
                <p class="text-slate-400 mb-8">15 Questions • 15 Minutes • Board Level MCQs</p>
                <button onclick="quizApp.start()" class="px-8 py-3 rounded-xl bg-white text-black font-bold hover:scale-105 transition-transform">Start Now</button>
            </div>

            <div id="screen-quiz" class="w-full hidden flex-col">
                <div class="mb-6">
                    <div class="text-blue-400 font-bold text-sm tracking-wider mb-2">QUESTION <span id="q-idx">1</span>/15</div>
                    <div id="q-text" class="text-xl md:text-2xl font-bold text-white leading-relaxed">Loading...</div>
                </div>
                <div id="options-box" class="space-y-3 mb-8 w-full"></div>
                <div class="flex justify-end">
                    <button id="btn-next" onclick="quizApp.next()" disabled class="px-6 py-3 rounded-xl bg-blue-600 text-white font-bold disabled:opacity-50 disabled:cursor-not-allowed hover:bg-blue-500 transition-colors">Next Question</button>
                </div>
            </div>

            <div id="screen-result" class="w-full hidden flex-col">
                <div class="bg-[#1e293b] border border-white/5 rounded-2xl p-6 mb-6 flex flex-col md:flex-row items-center justify-between gap-6 shadow-lg">
                    <div class="text-center md:text-left">
                        <p class="text-slate-400 text-xs uppercase tracking-widest font-bold mb-1">Total Score</p>
                        <div class="text-5xl font-black text-white"><span id="score">0</span><span class="text-2xl text-slate-500">/15</span></div>
                        <div id="score-text" class="text-green-400 font-bold mt-2">0% Accuracy</div>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="pie-chart" id="chart-pie">
                            <div class="pie-inner" id="pie-text">0%</div>
                        </div>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="quizApp.start()" class="px-5 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-white text-xs font-bold transition-colors border border-white/10">Retake Quiz</button>
                        <button onclick="exitQuiz()" class="px-5 py-2 rounded-lg bg-blue-600 hover:bg-blue-500 text-white text-xs font-bold transition-colors">Finish & Save</button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-[#1e293b] border border-white/5 rounded-2xl p-6 shadow-lg">
                        <div class="text-slate-400 text-xs uppercase tracking-widest font-bold mb-4 flex items-center gap-2">
                            <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 002 2h2a2 2 0 002-2z"></path></svg>
                            Topic Wise Performance
                        </div>
                        <div id="chart-bars" class="space-y-4"></div>
                    </div>

                    <div class="bg-[#1e293b] border border-white/5 rounded-2xl p-6 shadow-lg">
                        <div class="text-slate-400 text-xs uppercase tracking-widest font-bold mb-4 flex items-center gap-2">
                            <svg class="w-4 h-4 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path></svg>
                            Analysis Graph
                        </div>
                        <div id="topic-graph" class="graph-container">
                        </div>
                    </div>
                </div>

                <h3 class="text-xl font-bold text-white mb-4 pl-1 border-l-4 border-blue-500">Detailed Review</h3>
                <div id="review-box" class="space-y-4 w-full"></div>
            </div>
        </div>
    </main>

    <script>
        // --- 1. SMART PROGRESS TRACKING LOGIC (UPDATED FOR CHAPTER 3) ---
        const KEY_PROGRESS = 'physics_chapter_3_progress'; 
        const KEY_STATE = 'physics_chapter_3_state';       

        const LOCK_TIME = 7200; // 2 HOURS
        const INTERVAL_DURATION = 1800; // 30 Minutes

        const DEFAULT_STATE = {
            manual: false, // Worth 50%
            test: false,   // Worth 20%
            timeIntervals: 0, // Max 4, worth 7.5% each (Total 30%)
            timeSpentSeconds: 0 
        };
        
        let chapterState = { ...DEFAULT_STATE };

        document.addEventListener('DOMContentLoaded', () => {
            loadState();
            startTimer();
            updateUI();
            saveAndCalculate(); 
        });

        function loadState() {
            const savedState = localStorage.getItem(KEY_STATE);
            if (savedState) {
                try {
                    const parsed = JSON.parse(savedState);
                    chapterState = { ...DEFAULT_STATE, ...parsed };
                    if(typeof chapterState.timeIntervals !== 'number') chapterState.timeIntervals = 0;
                    if(typeof chapterState.timeSpentSeconds !== 'number') chapterState.timeSpentSeconds = 0;
                } catch(e) {
                    console.error("State load error, resetting", e);
                    chapterState = { ...DEFAULT_STATE };
                }
            }
        }

        function saveAndCalculate() {
            localStorage.setItem(KEY_STATE, JSON.stringify(chapterState));
            
            // MATH: 50% + 20% + (4 * 7.5%) = 100%
            let percent = 0;
            if (chapterState.manual) percent += 50;
            if (chapterState.test) percent += 20;
            percent += (chapterState.timeIntervals * 7.5);

            if (percent > 100) percent = 100; 
            
            const displayPercent = Math.floor(percent);

            localStorage.setItem(KEY_PROGRESS, displayPercent.toString());

            const indicator = document.getElementById('live-indicator');
            const txt = document.getElementById('live-percent');
            const bar = document.getElementById('visual-progress');
            
            if(txt) txt.innerText = `${displayPercent}%`;
            if(bar) bar.style.width = `${displayPercent}%`;
            
            if (indicator) {
                if (displayPercent === 100) {
                    indicator.classList.remove('bg-orange-500', 'animate-pulse');
                    indicator.classList.add('bg-green-500');
                } else {
                    indicator.classList.add('bg-orange-500', 'animate-pulse');
                    indicator.classList.remove('bg-green-500');
                }
            }
        }

        function startTimer() {
            setInterval(() => {
                chapterState.timeSpentSeconds++;
                
                // 1. INTERVAL CHECK
                let currentIntervals = Math.floor(chapterState.timeSpentSeconds / INTERVAL_DURATION);
                if (currentIntervals > 4) currentIntervals = 4;

                if (currentIntervals > chapterState.timeIntervals) {
                    chapterState.timeIntervals = currentIntervals;
                    saveAndCalculate();
                    const status = document.getElementById('save-status');
                    if(status) {
                        status.innerText = `Progress Added (+7.5%)`;
                        setTimeout(() => status.innerText = "Tracking Progress...", 3000);
                    }
                }

                // 2. UNLOCK CHECK
                const isLockedUI = document.getElementById('mark-btn-text').innerText.includes('Locked');
                if (chapterState.timeSpentSeconds >= LOCK_TIME && isLockedUI) {
                    updateUI(); 
                    const status = document.getElementById('save-status');
                    if(status) status.innerText = "Chapter Unlocked!";
                }

                if (chapterState.timeSpentSeconds % 10 === 0) {
                    localStorage.setItem(KEY_STATE, JSON.stringify(chapterState));
                }
            }, 1000);
        }

        function toggleStatus() {
            if (chapterState.timeSpentSeconds < LOCK_TIME && !chapterState.manual) {
                alert("You must watch this lecture for at least 2 hours before marking it as complete.");
                return;
            }
            chapterState.manual = !chapterState.manual; 
            updateUI(); 
            saveAndCalculate(); 
        }

        function updateUI() {
            const btn = document.getElementById('mark-done-btn');
            if(!btn) return;
            
            const icon = btn.querySelector('.check-icon');
            const text = document.getElementById('mark-btn-text');
            const circle = btn.querySelector('div');
            const isLocked = chapterState.timeSpentSeconds < LOCK_TIME && !chapterState.manual;

            if (chapterState.manual) {
                btn.classList.remove('bg-slate-800', 'opacity-50', 'cursor-not-allowed');
                btn.classList.add('bg-green-600', 'hover:bg-green-500', 'border-green-500', 'text-white');
                circle.classList.remove('border-slate-400');
                circle.classList.add('border-white', 'bg-white/20');
                icon.classList.remove('opacity-0');
                text.innerText = "Completed";
            } else if (isLocked) {
                btn.classList.add('bg-slate-800', 'opacity-50', 'cursor-not-allowed');
                btn.classList.remove('bg-green-600', 'hover:bg-green-500', 'border-green-500', 'text-white');
                circle.classList.add('border-slate-400');
                circle.classList.remove('border-white', 'bg-white/20');
                icon.classList.add('opacity-0');
                text.innerText = "Locked (Studying...)";
            } else {
                btn.classList.remove('opacity-50', 'cursor-not-allowed', 'bg-green-600');
                btn.classList.add('bg-slate-800', 'hover:bg-slate-700');
                circle.classList.add('border-slate-400');
                icon.classList.add('opacity-0');
                text.innerText = "Mark Complete";
            }
        }

        function finishQuizInternal() {
            if (!chapterState.test) {
                chapterState.test = true;
                saveAndCalculate();
            }
        }

        const contentView = document.getElementById('content-view');
        const quizView = document.getElementById('quiz-view');
        const headerSub = document.getElementById('header-subtitle');
        const quizBackBtn = document.getElementById('quiz-back-btn');
        const saveStatus = document.getElementById('save-status');

        function startQuiz() {
            contentView.classList.add('hidden');
            quizView.classList.remove('hidden');
            quizView.classList.add('flex');
            headerSub.innerText = "Quiz Mode";
            quizBackBtn.classList.remove('hidden');
            saveStatus.classList.add('hidden');
            const iframe = document.getElementById('main-player');
            const src = iframe.src;
            iframe.src = ''; 
            iframe.setAttribute('data-src', src); 
        }

        function exitQuiz() {
            quizView.classList.add('hidden');
            quizView.classList.remove('flex');
            contentView.classList.remove('hidden');
            headerSub.innerText = "Now Watching";
            quizBackBtn.classList.add('hidden');
            saveStatus.classList.remove('hidden');
            const iframe = document.getElementById('main-player');
            const savedSrc = iframe.getAttribute('data-src');
            if(savedSrc) iframe.src = savedSrc;
        }

        // --- QUESTION DATA (From TEST.HTML) ---
        const questions = [
            {
                id: 1,
                text: "Why is the path of electrons between successive collisions curved in the presence of an electric field, but straight in its absence?",
                options: ["Due to magnetic field", "Due to acceleration by electric force", "Due to increased thermal speed", "Due to variable relaxation time"],
                correct: 1,
                topic: "Drift Mechanics",
                explanation: "In the absence of an E-field, electrons move in straight lines. With an E-field, the force F = -eE causes acceleration, curving the path between collisions."
            },
            {
                id: 2,
                text: "The vector form of Ohm's Law is given by (where j = current density, σ = conductivity):",
                options: ["V = IR", "E = jρ", "j = σE", "Both B and C"],
                correct: 3,
                topic: "Ohm's Law",
                explanation: "Ohm's law relates current density and field. j = σE is the vector form. Since ρ = 1/σ, E = jρ is also correct."
            },
            {
                id: 3,
                text: "Why does the resistivity of a metal INCREASE with an increase in temperature?",
                options: ["Free electron density 'n' decreases", "Relaxation time 'τ' decreases", "Mass of electron increases", "Length of conductor increases"],
                correct: 1,
                topic: "Resistivity (Metals)",
                explanation: "As Temp rises, thermal speed increases, causing more frequent collisions. This reduces the average relaxation time (τ). Since ρ ∝ 1/τ, resistivity increases."
            },
            {
                id: 4,
                text: "In contrast to metals, why does the resistivity of semiconductors DECREASE with temperature?",
                options: ["Relaxation time increases significantly", "Number density 'n' of charge carriers increases exponentially", "Atoms stop vibrating", "They obey Ohm's law better at high T"],
                correct: 1,
                topic: "Resistivity (Semi)",
                explanation: "In semiconductors, 'n' increases significantly with temperature. This increase dominates the decrease in 'τ', so ρ decreases."
            },
            {
                id: 5,
                text: "Even though electron drift speed is extremely small (~mm/s), why is the current established almost instantly in a circuit?",
                options: ["Electrons move at the speed of light", "Current is not carried by electrons", "Electric field propagates at the speed of light", "Electrons adjacent to the source move first"],
                correct: 2,
                topic: "Drift vs Field",
                explanation: "The electric field propagates through the conductor at the speed of electromagnetic waves (~c), causing electrons everywhere to start drifting almost simultaneously."
            },
            {
                id: 6,
                text: "Kirchhoff's Loop Rule (ΣΔV = 0) is a direct consequence of which conservation law?",
                options: ["Conservation of Charge", "Conservation of Momentum", "Conservation of Energy", "Conservation of Mass"],
                correct: 2,
                topic: "Kirchhoff's Rules",
                explanation: "Electrostatic force is conservative. The work done in a closed loop is zero, which implies Conservation of Energy."
            },
            {
                id: 7,
                text: "Under what condition is the terminal voltage 'V' of a cell GREATER than its emf 'ε'?",
                options: ["When the cell is discharging", "When the cell is in open circuit", "When the cell is being charged", "When internal resistance is zero"],
                correct: 2,
                topic: "Cells & EMF",
                explanation: "During charging, current is forced into the positive terminal. The equation becomes V = ε + Ir, so V > ε."
            },
            {
                id: 8,
                text: "Why are alloys like Manganin and Constantan used for making standard resistors?",
                options: ["They have very low resistivity", "They have a very low temperature coefficient of resistance", "They are cheap", "They are superconductors"],
                correct: 1,
                topic: "Resistivity",
                explanation: "Their resistance changes very little with temperature (low α), making them ideal for standard resistors."
            },
            {
                id: 9,
                text: "In a Wheatstone bridge, the 'Balance Condition' (no current in galvanometer) is valid because:",
                options: ["Points B and D are at the same potential", "The battery has no internal resistance", "The galvanometer has infinite resistance", "Current flows from B to D"],
                correct: 0,
                topic: "Wheatstone Bridge",
                explanation: "If I_g = 0, no current flows between B and D, implying V(B) = V(D)."
            },
            {
                id: 10,
                text: "Electric power is transmitted from power stations at very high voltages. Why?",
                options: ["To increase the current", "To minimize power loss in transmission cables", "Because transformers only work at high voltage", "To speed up electricity"],
                correct: 1,
                topic: "Power",
                explanation: "Power loss Pc = P²Rc / V². Increasing voltage V drastically reduces power loss (inverse square relation)."
            },
            {
                id: 11,
                text: "Materials like GaAs (Gallium Arsenide) show a region where current decreases as voltage increases. This is called:",
                options: ["Superconductivity", "Negative Resistance Region", "Ohmic Region", "Saturation Region"],
                correct: 1,
                topic: "Ohm's Limitations",
                explanation: "In certain materials/devices, the V-I curve can have a negative slope, known as the negative resistance region."
            },
            {
                id: 12,
                text: "Current Density 'j' is a vector quantity. What is its direction?",
                options: ["Direction of electron drift", "Opposite to Electric Field", "Direction of Electric Field E", "Perpendicular to area vector"],
                correct: 2,
                topic: "Current Density",
                explanation: "Current density j is defined as vector parallel to the Electric Field E (or flow of positive charge)."
            },
            {
                id: 13,
                text: "If n identical cells (emf ε, internal resistance r) are connected in parallel, the effective emf and internal resistance are:",
                options: ["nε, nr", "ε, r/n", "nε, r/n", "ε, nr"],
                correct: 1,
                topic: "Cells Combination",
                explanation: "For parallel cells of equal emf, the equivalent emf is ε, and equivalent resistance is r/n."
            },
            {
                id: 14,
                text: "Is Ohm's Law a fundamental law of nature?",
                options: ["Yes, like Newton's Laws", "Yes, valid for all materials", "No, it's an empirical relation valid for some materials", "No, it only applies to liquids"],
                correct: 2,
                topic: "Ohm's Limitations",
                explanation: "Ohm's law is widely obeyed but isn't fundamental. Many devices (diodes, transistors) violate it."
            },
            {
                id: 15,
                text: "In the equation for drift velocity v_d = -eEτ/m, what does τ represent?",
                options: ["Total time of travel", "Time for current to stabilize", "Average time between successive collisions", "Time taken to cross the conductor"],
                correct: 2,
                topic: "Drift Mechanics",
                explanation: "τ is the relaxation time, which is the average time elapsed between two successive collisions of an electron."
            }
        ];

        const quizApp = {
            idx: 0, answers: Array(questions.length).fill(null), timer: 900, interval: null,

            start: function() {
                this.idx = 0; this.answers.fill(null); this.timer = 900;
                document.getElementById('screen-start').classList.add('hidden');
                document.getElementById('screen-result').classList.add('hidden');
                document.getElementById('screen-result').classList.remove('flex');
                const quizScreen = document.getElementById('screen-quiz');
                quizScreen.classList.remove('hidden');
                quizScreen.classList.add('flex');
                this.renderQ();
                this.startTimer();
            },

            startTimer: function() {
                clearInterval(this.interval);
                this.interval = setInterval(() => {
                    if(this.timer <= 0) { this.finish(); return; }
                    this.timer--;
                    const m = Math.floor(this.timer / 60);
                    const s = this.timer % 60;
                    document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
                }, 1000);
            },

            renderQ: function() {
                const q = questions[this.idx];
                document.getElementById('q-idx').innerText = this.idx + 1;
                document.getElementById('q-text').innerText = q.text;
                const box = document.getElementById('options-box');
                box.innerHTML = '';
                const nextBtn = document.getElementById('btn-next');
                nextBtn.disabled = true;
                nextBtn.innerText = (this.idx === questions.length - 1) ? "Submit Quiz" : "Next Question";

                q.options.forEach((opt, i) => {
                    const div = document.createElement('div');
                    div.className = 'quiz-option';
                    div.innerHTML = `<div class="quiz-circle"></div><span class="text-slate-300 font-medium">${opt}</span>`;
                    div.onclick = () => this.select(i, div);
                    box.appendChild(div);
                });
            },

            select: function(optIdx, el) {
                this.answers[this.idx] = optIdx;
                document.querySelectorAll('.quiz-option').forEach(x => x.classList.remove('selected'));
                el.classList.add('selected');
                document.getElementById('btn-next').disabled = false;
            },

            next: function() {
                if(this.idx < questions.length - 1) { this.idx++; this.renderQ(); } 
                else { this.finish(); }
            },

            finish: function() {
                clearInterval(this.interval);
                let correctCount = 0;
                let topicStats = {};

                questions.forEach((q, i) => {
                    const isCorrect = (this.answers[i] === q.correct);
                    if(isCorrect) correctCount++;
                    if(!topicStats[q.topic]) topicStats[q.topic] = { total: 0, right: 0 };
                    topicStats[q.topic].total++;
                    if(isCorrect) topicStats[q.topic].right++;
                });

                document.getElementById('screen-quiz').classList.add('hidden');
                document.getElementById('screen-quiz').classList.remove('flex');
                const resultScreen = document.getElementById('screen-result');
                resultScreen.classList.remove('hidden');
                resultScreen.classList.add('flex');

                document.getElementById('score').innerText = correctCount;
                const pct = Math.round((correctCount / questions.length) * 100);
                document.getElementById('score-text').innerText = `${pct}% Accuracy`;
                const deg = (correctCount / questions.length) * 360;
                document.getElementById('chart-pie').style.background = `conic-gradient(#22c55e 0deg ${deg}deg, #ef4444 ${deg}deg 360deg)`;
                document.getElementById('pie-text').innerText = `${pct}%`;

                const barBox = document.getElementById('chart-bars');
                const graphBox = document.getElementById('topic-graph');
                barBox.innerHTML = '';
                graphBox.innerHTML = '';

                for (const [topic, data] of Object.entries(topicStats)) {
                    const topicPct = Math.round((data.right / data.total) * 100);
                    barBox.innerHTML += `
                        <div class="text-sm">
                            <div class="flex justify-between text-slate-400 mb-1">
                                <span class="font-medium text-white">${topic}</span>
                                <span>${data.right}/${data.total}</span>
                            </div>
                            <div class="bar-bg"><div class="bar-fill" style="width: ${topicPct}%"></div></div>
                        </div>`;
                    graphBox.innerHTML += `
                        <div class="graph-bar-group">
                            <div class="graph-bar" style="height: ${topicPct}%;">
                                <div class="graph-value">${topicPct}%</div>
                            </div>
                            <div class="graph-label">${topic}</div>
                        </div>`;
                }

                finishQuizInternal(); 

                const reviewBox = document.getElementById('review-box');
                reviewBox.innerHTML = '';
                questions.forEach((q, i) => {
                    const isRight = (this.answers[i] === q.correct);
                    reviewBox.innerHTML += `
                        <div class="p-4 rounded-xl border border-white/5 bg-[#1e293b] ${isRight ? 'border-l-4 border-l-green-500' : 'border-l-4 border-l-red-500'}">
                            <p class="font-bold text-white mb-2 text-base">Q${i+1}: ${q.text}</p>
                            <div class="text-sm mb-2"><span class="${isRight ? 'text-green-400' : 'text-red-400'}">Answer: ${this.answers[i]!==null?q.options[this.answers[i]]:'Skipped'}</span></div>
                            <div class="text-xs text-slate-400">${q.explanation}</div>
                        </div>`;
                });
            }
        };
    </script>
</body>
</html>