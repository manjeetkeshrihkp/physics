<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecture Player | JEE Matrix</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { 
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Merriweather', 'serif'],
                    },
                    colors: { background: '#020617' },
                    animation: { 'fade-in': 'fadeIn 0.5s ease-out forwards' },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #020617;
            color: #f8fafc;
            background-image: linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            min-height: 100vh;
        }

        /* Video Container (16:9) */
        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            background: #000;
            border-radius: 16px;
            box-shadow: 0 20px 50px -12px rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .video-container iframe {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }

        /* Notes Specific Styles */
        .notes-content p, .notes-content li {
            font-family: 'Merriweather', serif;
            color: #cbd5e1; /* slate-300 */
            line-height: 1.8;
            margin-bottom: 1rem;
        }
        .notes-content h2 {
            font-family: 'Inter', sans-serif;
            color: #a78bfa; /* violet-400 */
            font-weight: 700;
            font-size: 1.5rem;
            margin-top: 3rem;
            margin-bottom: 1rem;
            border-left: 4px solid #a78bfa;
            padding-left: 1rem;
        }
        .notes-content h3 {
            font-family: 'Inter', sans-serif;
            color: #f8fafc; /* white */
            font-weight: 600;
            font-size: 1.25rem;
            margin-top: 2rem;
            margin-bottom: 0.75rem;
        }
        .notes-content strong { color: #fff; }
        .notes-content ul { list-style-type: disc; padding-left: 1.5rem; margin-bottom: 1.5rem; }
        .notes-content ol { list-style-type: decimal; padding-left: 1.5rem; margin-bottom: 1.5rem; }
        
        .formula-box {
            background-color: #1e293b; /* slate-800 */
            border: 1px solid rgba(255,255,255,0.1);
            padding: 1.5rem;
            border-radius: 12px;
            margin: 1.5rem 0;
            text-align: center;
            font-family: 'Inter', sans-serif;
            overflow-x: auto;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
        }

        .note-highlight {
            background-color: rgba(59, 130, 246, 0.1); /* blue-500/10 */
            border-left: 4px solid #3b82f6; /* blue-500 */
            padding: 1rem 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
            font-style: italic;
        }

        /* Tables */
        .notes-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background-color: #1e293b;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .notes-table th, .notes-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .notes-table th {
            background-color: rgba(0,0,0,0.3);
            color: #a78bfa;
            font-weight: 700;
        }

        /* Quiz Specifics */
        .quiz-option {
            background: #1e293b;
            border: 1px solid rgba(255,255,255,0.1);
            padding: 1rem 1.25rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .quiz-option:hover { background: #334155; }
        .quiz-option.selected { background: rgba(139, 92, 246, 0.2); border-color: #8b5cf6; }
        
        .quiz-circle { width: 20px; height: 20px; border: 2px solid #64748b; border-radius: 50%; flex-shrink: 0; }
        .quiz-option.selected .quiz-circle { border-color: #8b5cf6; background: #8b5cf6; }

        /* Pie Chart */
        .pie-chart {
            width: 120px; height: 120px; border-radius: 50%;
            margin: 15px 0;
            background: conic-gradient(#22c55e 0deg, #ef4444 0deg);
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
        }
        .pie-inner {
            position: absolute; top: 15px; left: 15px;
            width: 90px; height: 90px;
            background: #1e293b; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; color: #fff;
        }

        /* Vertical Graph Styles */
        .graph-container {
            height: 180px;
            display: flex;
            align-items: flex-end;
            gap: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid rgba(255,255,255,0.1);
            margin-top: 20px;
        }
        .graph-bar-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
            justify-content: flex-end;
        }
        .graph-bar {
            width: 100%;
            background: linear-gradient(to top, #8b5cf6, #c084fc);
            border-radius: 4px 4px 0 0;
            transition: height 1s ease-out;
            position: relative;
            min-height: 4px;
        }
        .graph-label {
            margin-top: 10px;
            font-size: 0.7rem;
            color: #94a3b8;
            text-align: center;
            width: 100%;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .graph-value {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.7rem;
            color: #fff;
            font-weight: bold;
        }
        .bar-bg { background: rgba(255,255,255,0.05); height: 6px; border-radius: 99px; overflow: hidden; }
        .bar-fill { height: 100%; background: #a78bfa; transition: width 1s ease; }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden">

    <header class="h-16 border-b border-white/5 bg-[#020617]/90 backdrop-blur-md flex items-center justify-between px-6 z-[100] flex-shrink-0 relative">
        <div class="flex items-center gap-4">
            <a href="physics.html" class="w-10 h-10 rounded-full hover:bg-white/5 flex items-center justify-center text-slate-400 hover:text-white transition-all group cursor-pointer" title="Back to Chapters">
                <svg class="w-5 h-5 group-hover:-translate-x-1 transition-transform pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
            </a>
            <div>
                <p class="text-[10px] uppercase tracking-widest text-violet-400 font-bold" id="header-subtitle">Now Watching</p>
                <h1 id="header-title" class="text-sm md:text-base font-bold text-white truncate max-w-[200px] md:max-w-md">Electric Charges & Fields</h1>
            </div>
        </div>
        <div class="flex items-center gap-3">
            <button id="quiz-back-btn" onclick="exitQuiz()" class="hidden px-3 py-1.5 text-xs font-bold bg-white/10 hover:bg-white/20 rounded-lg text-white transition-colors border border-white/10">
                Back to Lecture
            </button>
            <span class="text-xs text-slate-500 font-medium hidden md:block" id="save-status">Tracking Progress...</span>
            <div class="flex items-center gap-2 bg-slate-800 px-3 py-1 rounded-full border border-white/10">
                 <div class="w-2 h-2 rounded-full bg-orange-500 animate-pulse" id="live-indicator"></div>
                 <span class="text-xs font-bold text-white" id="live-percent">0%</span>
            </div>
        </div>
        <div id="visual-progress" class="absolute bottom-0 left-0 h-1 bg-gradient-to-r from-violet-500 to-fuchsia-500 transition-all duration-700 ease-in-out shadow-[0_0_10px_rgba(167,139,250,0.5)]" style="width: 0%"></div>
    </header>

    <main class="flex-grow overflow-y-auto p-4 md:p-8 flex flex-col items-center relative">
        
        <div id="content-view" class="w-full max-w-4xl animate-fade-in pb-20">
            
            <div class="video-container mb-6">
                <iframe id="main-player" src="https://www.youtube.com/embed/RJF5LrP8eSw?autoplay=0&rel=0&modestbranding=1" title="Video Player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>

            <div class="flex flex-col md:flex-row items-center justify-between gap-4 p-6 bg-[#0f172a] border border-white/5 rounded-2xl shadow-lg mb-10">
                <div class="w-full md:w-auto">
                    <h2 id="video-title" class="text-2xl font-bold text-white mb-1">Electric Charges and Fields</h2>
                    <p class="text-slate-400 text-sm">Physics • Class 12</p>
                </div>
                <div class="flex items-center gap-3 w-full md:w-auto">
                    
                    <button id="mark-done-btn" onclick="toggleStatus()" class="flex-1 md:flex-none flex items-center justify-center gap-2 px-5 py-3 rounded-xl bg-slate-800 border border-slate-600 transition-all text-sm font-semibold text-slate-200 group cursor-not-allowed opacity-50">
                        <div class="w-5 h-5 rounded-full border-2 border-slate-400 group-hover:border-white flex items-center justify-center">
                            <svg class="w-3 h-3 text-white opacity-0 transition-opacity check-icon" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"></path></svg>
                        </div>
                        <span class="btn-text" id="mark-btn-text">Locked (Studying...)</span>
                    </button>
                    
                    <button onclick="startQuiz()" class="flex-1 md:flex-none flex items-center justify-center gap-2 px-6 py-3 rounded-xl bg-gradient-to-r from-violet-600 to-fuchsia-600 hover:from-violet-500 hover:to-fuchsia-500 text-white font-bold shadow-lg shadow-violet-500/20 hover:shadow-violet-500/40 hover:-translate-y-0.5 transition-all group">
                        <span>Take Test</span>
                        <svg class="w-5 h-5 group-hover:rotate-6 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                    </button>
                </div>
            </div>

            <div id="detailed-notes" class="notes-content">
                <div class="flex items-center gap-3 mb-6">
                    <div class="h-8 w-1 bg-violet-500 rounded-full"></div>
                    <h2 class="!m-0 !border-0 !p-0 text-3xl text-white">Detailed Physics Notes</h2>
                </div>
                
                <p class="text-slate-400 italic mb-8">Comprehensive notes based on NCERT Class 12 Physics - Chapter 1</p>

                <section id="intro">
                    <h2>1. Introduction & Electric Charge</h2>
                    <p><strong>Electrostatics</strong> is the study of forces, fields, and potentials arising from static charges. Historically, Thales of Miletus (600 BC) discovered that amber rubbed with wool attracts light objects.</p>
                    
                    <h3>Electric Charge</h3>
                    <ul>
                        <li><strong>Definition:</strong> An intrinsic property of elementary particles which gives rise to electric force between objects.</li>
                        <li><strong>Two Types of Charges:</strong>
                            <ul>
                                <li><strong>Positive (+):</strong> Acquired by a glass rod when rubbed with silk, or cat's fur.</li>
                                <li><strong>Negative (-):</strong> Acquired by a plastic rod when rubbed with wool/fur, or silk cloth.</li>
                            </ul>
                        </li>
                        <li><strong>Fundamental Law:</strong> Like charges repel and unlike charges attract each other.</li>
                        <li><strong>Electronic Theory:</strong> Electrification occurs due to the transfer of electrons. Losing electrons makes a body positive; gaining electrons makes it negative.</li>
                    </ul>
                    <div class="note-highlight">
                        <strong>Gold-leaf Electroscope:</strong> A simple apparatus to detect charge on a body. The degree of divergence of the gold leaves indicates the amount of charge.
                    </div>
                </section>

                <section id="conductors">
                    <h2>2. Conductors and Insulators</h2>
                    <p>Materials are classified based on their ability to allow the passage of electricity.</p>
                    <ul>
                        <li><strong>Conductors:</strong> Allow electricity to pass through easily. They have free electrons (electric charges) that are free to move inside the material.
                        <br><em>Examples:</em> Metals, human/animal bodies, earth.</li>
                        <li><strong>Insulators:</strong> Offer high resistance to electricity.
                        <br><em>Examples:</em> Glass, porcelain, plastic, nylon, wood.</li>
                        <li><strong>Earthing:</strong> Sharing charges with the earth. The earth acts as a vast conductor.</li>
                    </ul>
                </section>

                <section id="properties">
                    <h2>3. Basic Properties of Electric Charge</h2>
                    
                    <h3>A. Additivity of Charges</h3>
                    <p>Total charge of a system is the algebraic sum of all individual charges.</p>
                    <div class="formula-box">
                        $$ Q_{total} = q_1 + q_2 + q_3 + ... + q_n $$
                    </div>

                    <h3>B. Conservation of Charge</h3>
                    <p>For an isolated system, the total charge is always conserved. Charges can be transferred but not created or destroyed.</p>
                    
                    <h3>C. Quantisation of Charge</h3>
                    <p>All free charges are integral multiples of a basic unit of charge \( e \).</p>
                    <div class="formula-box">
                        $$ q = ne $$
                        <br>
                        Where \( n \) is an integer and \( e = 1.602 \times 10^{-19} \, \text{C} \).
                    </div>
                    <div class="note-highlight">
                        <strong>Note:</strong> Quantisation is usually ignored at macroscopic levels because the elementary charge \( e \) is very small compared to macroscopic charges (micro-Coulombs).
                    </div>
                </section>

                <section id="coulomb">
                    <h2>4. Coulomb's Law</h2>
                    <p>Describes the force between two point charges.</p>
                    
                    <h3>Statement</h3>
                    <p>The force is directly proportional to the product of the magnitude of the two charges and inversely proportional to the square of the distance between them. It acts along the line joining the two charges.</p>
                    
                    <h3>Scalar Formula</h3>
                    <div class="formula-box">
                        $$ F = k \frac{|q_1 q_2|}{r^2} = \frac{1}{4\pi\epsilon_0} \frac{|q_1 q_2|}{r^2} $$
                    </div>
                    <ul>
                        <li>\( \epsilon_0 \) (Permittivity of free space) = \( 8.854 \times 10^{-12} \, \text{C}^2\text{N}^{-1}\text{m}^{-2} \).</li>
                        <li>\( k \approx 9 \times 10^9 \, \text{N m}^2\text{C}^{-2} \).</li>
                    </ul>

                    <h3>Vector Form</h3>
                    <div class="formula-box">
                        $$ \mathbf{F}_{21} = \frac{1}{4\pi\epsilon_0} \frac{q_1 q_2}{r_{21}^2} \hat{\mathbf{r}}_{21} $$
                    </div>
                    <p>Here \( \mathbf{F}_{21} \) is the force on \( q_2 \) due to \( q_1 \).</p>
                    
                    <h3>Superposition Principle</h3>
                    <p>Force on any charge due to a number of other charges is the vector sum of all the forces on that charge due to the other charges, taken one at a time.</p>
                    <div class="formula-box">
                        $$ \mathbf{F}_1 = \mathbf{F}_{12} + \mathbf{F}_{13} + ... + \mathbf{F}_{1n} $$
                    </div>
                </section>

                <section id="electric-field">
                    <h2>5. Electric Field</h2>
                    <p><strong>Definition:</strong> Force experienced by a unit positive test charge placed at a point.</p>
                    <div class="formula-box">
                        $$ \mathbf{E} = \lim_{q \to 0} \frac{\mathbf{F}}{q} $$
                    </div>
                    
                    <h3>Field due to a Point Charge</h3>
                    <div class="formula-box">
                        $$ \mathbf{E} = \frac{1}{4\pi\epsilon_0} \frac{Q}{r^2} \hat{\mathbf{r}} $$
                    </div>
                    <ul>
                        <li>Radially <strong>outward</strong> for positive charge \( Q > 0 \).</li>
                        <li>Radially <strong>inward</strong> for negative charge \( Q < 0 \).</li>
                    </ul>
                </section>

                <section id="field-lines">
                    <h2>6. Electric Field Lines & Flux</h2>
                    


                    <h3>Properties of Field Lines</h3>
                    <ul>
                        <li>Start from positive charge and end at negative charge.</li>
                        <li>Continuous curves without breaks in a charge-free region.</li>
                        <li><strong>Two lines never cross each other</strong>.</li>
                        <li>They do not form closed loops (electrostatic field is conservative).</li>
                        <li>Relative density indicates field strength (closer lines = stronger field).</li>
                    </ul>

                    <h3>Electric Flux (\( \Phi \))</h3>
                    <p>Measure of the number of field lines crossing a given area.</p>
                    <div class="formula-box">
                        $$ \Delta\Phi = \mathbf{E} \cdot \Delta\mathbf{S} = E \Delta S \cos\theta $$
                    </div>
                    <p>Where \( \theta \) is the angle between \( \mathbf{E} \) and the area vector normal \( \hat{\mathbf{n}} \).</p>
                </section>

                <section id="dipole">
                    <h2>7. Electric Dipole</h2>
                    <p>A pair of equal and opposite charges \( q \) and \( -q \) separated by distance \( 2a \).</p>
                    <p><strong>Dipole Moment (\( \mathbf{p} \)):</strong> \( \mathbf{p} = q \times 2\mathbf{a} \) (Directed from -q to +q).</p>
                    
                    <h3>Electric Field of a Dipole</h3>
                    <ul>
                        <li><strong>On the Axis:</strong>
                            $$ \mathbf{E} = \frac{2\mathbf{p}}{4\pi\epsilon_0 r^3} \quad (\text{for } r \gg a) $$
                        </li>
                        <li><strong>On Equatorial Plane:</strong>
                            $$ \mathbf{E} = -\frac{\mathbf{p}}{4\pi\epsilon_0 r^3} \quad (\text{for } r \gg a) $$
                        </li>
                    </ul>

                    <h3>Torque on Dipole in Uniform Field</h3>
                    <div class="formula-box">
                        $$ \boldsymbol{\tau} = \mathbf{p} \times \mathbf{E} $$
                        $$ \tau = pE \sin\theta $$
                    </div>
                    <p>Net force is zero in a uniform field, but torque tends to align dipole with the field.</p>
                </section>

                <section id="continuous">
                    <h2>8. Continuous Charge Distribution</h2>
                    <p>Charges distributed continuously over length, surface, or volume.</p>
                    <table class="notes-table">
                        <tr>
                            <th>Type</th>
                            <th>Symbol</th>
                            <th>Formula</th>
                            <th>Unit</th>
                        </tr>
                        <tr>
                            <td>Linear Charge Density</td>
                            <td>\( \lambda \)</td>
                            <td>\( \lambda = \Delta Q / \Delta l \)</td>
                            <td>C/m</td>
                        </tr>
                        <tr>
                            <td>Surface Charge Density</td>
                            <td>\( \sigma \)</td>
                            <td>\( \sigma = \Delta Q / \Delta S \)</td>
                            <td>C/m²</td>
                        </tr>
                        <tr>
                            <td>Volume Charge Density</td>
                            <td>\( \rho \)</td>
                            <td>\( \rho = \Delta Q / \Delta V \)</td>
                            <td>C/m³</td>
                        </tr>
                    </table>
                </section>

                <section id="gauss">
                    <h2>9. Gauss's Law</h2>
                    <p>The total electric flux through a closed surface is \( 1/\epsilon_0 \) times the net charge enclosed by the surface.</p>
                    <div class="formula-box">
                        $$ \Phi = \oint \mathbf{E} \cdot d\mathbf{S} = \frac{q_{enclosed}}{\epsilon_0} $$
                    </div>

                    <h3>Applications of Gauss's Law</h3>
                    
                    <h4>1. Infinitely Long Straight Wire</h4>
                    <p>For uniform linear charge density \( \lambda \):</p>
                    <div class="formula-box">
                        $$ E = \frac{\lambda}{2\pi\epsilon_0 r} \hat{\mathbf{n}} $$
                    </div>

                    <h4>2. Uniformly Charged Infinite Plane Sheet</h4>
                    <p>For uniform surface charge density \( \sigma \):</p>
                    <div class="formula-box">
                        $$ E = \frac{\sigma}{2\epsilon_0} \hat{\mathbf{n}} $$
                    </div>

                    <h4>3. Uniformly Charged Thin Spherical Shell</h4>
                    <p>For shell of radius \( R \) and charge \( q \):</p>
                    <ul>
                        <li><strong>Outside (\( r > R \)):</strong> \( E = \frac{q}{4\pi\epsilon_0 r^2} \) (Behaves like point charge at center).</li>
                        <li><strong>Inside (\( r < R \)):</strong> \( \mathbf{E} = 0 \).</li>
                    </ul>
                </section>
                
                <div class="mt-10 pt-6 border-t border-white/10 text-center text-slate-500 text-sm">
                    BRO YOU CAN AND YOU WILL ⚡
                </div>
            </div>
        </div>

        <div id="quiz-view" class="w-full max-w-4xl flex-col items-center animate-fade-in hidden pb-20">
            <div class="w-full bg-[#1e293b] border border-white/5 rounded-2xl p-4 mb-6 flex justify-between items-center shadow-lg">
                <h2 class="text-xl font-bold text-white">Physics Master Quiz</h2>
                <div class="px-3 py-1 bg-black/30 rounded-lg border border-white/10 font-mono text-lg text-white" id="timer">15:00</div>
            </div>

            <div id="screen-start" class="w-full bg-[#0f172a] border border-white/5 rounded-2xl p-8 text-center shadow-lg flex flex-col items-center">
                <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-violet-600 to-fuchsia-600 flex items-center justify-center mb-6 shadow-lg shadow-violet-500/20">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                </div>
                <h2 class="text-3xl font-bold text-white mb-2">Practice Quiz</h2>
                <p class="text-slate-400 mb-8">15 Questions • 15 Minutes • Board Level MCQs</p>
                <button onclick="quizApp.start()" class="px-8 py-3 rounded-xl bg-white text-black font-bold hover:scale-105 transition-transform">Start Now</button>
            </div>

            <div id="screen-quiz" class="w-full hidden flex-col">
                <div class="mb-6">
                    <div class="text-violet-400 font-bold text-sm tracking-wider mb-2">QUESTION <span id="q-idx">1</span>/15</div>
                    <div id="q-text" class="text-xl md:text-2xl font-bold text-white leading-relaxed">Loading...</div>
                </div>
                <div id="options-box" class="space-y-3 mb-8 w-full"></div>
                <div class="flex justify-end">
                    <button id="btn-next" onclick="quizApp.next()" disabled class="px-6 py-3 rounded-xl bg-violet-600 text-white font-bold disabled:opacity-50 disabled:cursor-not-allowed hover:bg-violet-500 transition-colors">Next Question</button>
                </div>
            </div>

            <div id="screen-result" class="w-full hidden flex-col">
                <div class="bg-[#1e293b] border border-white/5 rounded-2xl p-6 mb-6 flex flex-col md:flex-row items-center justify-between gap-6 shadow-lg">
                    <div class="text-center md:text-left">
                        <p class="text-slate-400 text-xs uppercase tracking-widest font-bold mb-1">Total Score</p>
                        <div class="text-5xl font-black text-white"><span id="score">0</span><span class="text-2xl text-slate-500">/15</span></div>
                        <div id="score-text" class="text-green-400 font-bold mt-2">0% Accuracy</div>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="pie-chart" id="chart-pie">
                            <div class="pie-inner" id="pie-text">0%</div>
                        </div>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="quizApp.start()" class="px-5 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-white text-xs font-bold transition-colors border border-white/10">Retake Quiz</button>
                        <button onclick="exitQuiz()" class="px-5 py-2 rounded-lg bg-violet-600 hover:bg-violet-500 text-white text-xs font-bold transition-colors">Finish & Save</button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-[#1e293b] border border-white/5 rounded-2xl p-6 shadow-lg">
                        <div class="text-slate-400 text-xs uppercase tracking-widest font-bold mb-4 flex items-center gap-2">
                            <svg class="w-4 h-4 text-violet-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 002 2h2a2 2 0 002-2z"></path></svg>
                            Topic Wise Performance
                        </div>
                        <div id="chart-bars" class="space-y-4"></div>
                    </div>

                    <div class="bg-[#1e293b] border border-white/5 rounded-2xl p-6 shadow-lg">
                        <div class="text-slate-400 text-xs uppercase tracking-widest font-bold mb-4 flex items-center gap-2">
                            <svg class="w-4 h-4 text-violet-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path></svg>
                            Analysis Graph
                        </div>
                        <div id="topic-graph" class="graph-container">
                        </div>
                    </div>
                </div>

                <h3 class="text-xl font-bold text-white mb-4 pl-1 border-l-4 border-violet-500">Detailed Review</h3>
                <div id="review-box" class="space-y-4 w-full"></div>
            </div>
        </div>
    </main>

    <script>
        // --- 1. SMART PROGRESS TRACKING LOGIC ---
        const KEY_PROGRESS = 'physics_chapter_1_progress'; 
        const KEY_STATE = 'physics_chapter_1_state';       

        const LOCK_TIME = 7200; // 2 HOURS (7200 seconds)
        const INTERVAL_DURATION = 1800; // 30 Minutes

        // Define default state to safely merge
        const DEFAULT_STATE = {
            manual: false, // Worth 50%
            test: false,   // Worth 20%
            timeIntervals: 0, // Max 4, worth 7.5% each (Total 30%)
            timeSpentSeconds: 0 
        };
        
        let chapterState = { ...DEFAULT_STATE };

        document.addEventListener('DOMContentLoaded', () => {
            loadState();
            startTimer();
            updateUI();
            saveAndCalculate(); // FIX: Call this immediately on load so progress is visible
        });

        function loadState() {
            const savedState = localStorage.getItem(KEY_STATE);
            if (savedState) {
                try {
                    const parsed = JSON.parse(savedState);
                    // MERGE WITH DEFAULT to prevent NaN if fields are missing from old versions
                    chapterState = { ...DEFAULT_STATE, ...parsed };
                    
                    // Safety checks
                    if(typeof chapterState.timeIntervals !== 'number') chapterState.timeIntervals = 0;
                    if(typeof chapterState.timeSpentSeconds !== 'number') chapterState.timeSpentSeconds = 0;
                    
                } catch(e) {
                    console.error("State load error, resetting", e);
                    chapterState = { ...DEFAULT_STATE };
                }
            }
        }

        function saveAndCalculate() {
            localStorage.setItem(KEY_STATE, JSON.stringify(chapterState));
            
            // MATH: 50% + 20% + (4 * 7.5%) = 100%
            let percent = 0;
            if (chapterState.manual) percent += 50;
            if (chapterState.test) percent += 20;
            percent += (chapterState.timeIntervals * 7.5);

            if (percent > 100) percent = 100; 
            
            // Ensure integer for display
            const displayPercent = Math.floor(percent);

            localStorage.setItem(KEY_PROGRESS, displayPercent.toString());

            const indicator = document.getElementById('live-indicator');
            const txt = document.getElementById('live-percent');
            const bar = document.getElementById('visual-progress'); // Fix: Get visual bar
            
            if(txt) txt.innerText = `${displayPercent}%`;
            if(bar) bar.style.width = `${displayPercent}%`; // Fix: Update visual bar width
            
            if (indicator) {
                if (displayPercent === 100) {
                    indicator.classList.remove('bg-orange-500', 'animate-pulse');
                    indicator.classList.add('bg-green-500');
                } else {
                    indicator.classList.add('bg-orange-500', 'animate-pulse');
                    indicator.classList.remove('bg-green-500');
                }
            }
        }

        function startTimer() {
            setInterval(() => {
                chapterState.timeSpentSeconds++;
                
                // 1. INTERVAL CHECK (Every 30 mins)
                let currentIntervals = Math.floor(chapterState.timeSpentSeconds / INTERVAL_DURATION);
                if (currentIntervals > 4) currentIntervals = 4;

                if (currentIntervals > chapterState.timeIntervals) {
                    chapterState.timeIntervals = currentIntervals;
                    saveAndCalculate();
                    const status = document.getElementById('save-status');
                    if(status) {
                        status.innerText = `Progress Added (+7.5%)`;
                        setTimeout(() => status.innerText = "Tracking Progress...", 3000);
                    }
                }

                // 2. UNLOCK CHECK (At 2 hours)
                // Fix: Check >= to catch edge cases if tab sleeps
                const isLockedUI = document.getElementById('mark-btn-text').innerText.includes('Locked');
                if (chapterState.timeSpentSeconds >= LOCK_TIME && isLockedUI) {
                    updateUI(); // Unlock button visually
                    const status = document.getElementById('save-status');
                    if(status) status.innerText = "Chapter Unlocked!";
                }

                if (chapterState.timeSpentSeconds % 10 === 0) {
                    localStorage.setItem(KEY_STATE, JSON.stringify(chapterState));
                }
            }, 1000);
        }

        function toggleStatus() {
            // Check Lock
            if (chapterState.timeSpentSeconds < LOCK_TIME && !chapterState.manual) {
                alert("You must watch this lecture for at least 2 hours before marking it as complete.");
                return;
            }

            chapterState.manual = !chapterState.manual; 
            updateUI(); 
            saveAndCalculate(); 
        }

        function updateUI() {
            const btn = document.getElementById('mark-done-btn');
            if(!btn) return;
            
            const icon = btn.querySelector('.check-icon');
            const text = document.getElementById('mark-btn-text');
            const circle = btn.querySelector('div');

            // Logic: Is it locked? (Time < 2h AND not already completed)
            const isLocked = chapterState.timeSpentSeconds < LOCK_TIME && !chapterState.manual;

            if (chapterState.manual) {
                // Completed State
                btn.classList.remove('bg-slate-800', 'opacity-50', 'cursor-not-allowed');
                btn.classList.add('bg-green-600', 'hover:bg-green-500', 'border-green-500', 'text-white');
                circle.classList.remove('border-slate-400');
                circle.classList.add('border-white', 'bg-white/20');
                icon.classList.remove('opacity-0');
                text.innerText = "Completed";
            } else if (isLocked) {
                // Locked State
                btn.classList.add('bg-slate-800', 'opacity-50', 'cursor-not-allowed');
                btn.classList.remove('bg-green-600', 'hover:bg-green-500', 'border-green-500', 'text-white');
                circle.classList.add('border-slate-400');
                circle.classList.remove('border-white', 'bg-white/20');
                icon.classList.add('opacity-0');
                text.innerText = "Locked (Studying...)";
            } else {
                // Unlocked State
                btn.classList.remove('opacity-50', 'cursor-not-allowed', 'bg-green-600');
                btn.classList.add('bg-slate-800', 'hover:bg-slate-700');
                circle.classList.add('border-slate-400');
                icon.classList.add('opacity-0');
                text.innerText = "Mark Complete";
            }
        }

        function finishQuizInternal() {
            if (!chapterState.test) {
                chapterState.test = true;
                saveAndCalculate();
            }
        }

        const contentView = document.getElementById('content-view');
        const quizView = document.getElementById('quiz-view');
        const headerSub = document.getElementById('header-subtitle');
        const quizBackBtn = document.getElementById('quiz-back-btn');
        const saveStatus = document.getElementById('save-status');

        function startQuiz() {
            contentView.classList.add('hidden');
            quizView.classList.remove('hidden');
            quizView.classList.add('flex');
            headerSub.innerText = "Quiz Mode";
            quizBackBtn.classList.remove('hidden');
            saveStatus.classList.add('hidden');
            const iframe = document.getElementById('main-player');
            const src = iframe.src;
            iframe.src = ''; 
            iframe.setAttribute('data-src', src); 
        }

        function exitQuiz() {
            quizView.classList.add('hidden');
            quizView.classList.remove('flex');
            contentView.classList.remove('hidden');
            headerSub.innerText = "Now Watching";
            quizBackBtn.classList.add('hidden');
            saveStatus.classList.remove('hidden');
            const iframe = document.getElementById('main-player');
            const savedSrc = iframe.getAttribute('data-src');
            if(savedSrc) iframe.src = savedSrc;
        }

        const questions = [
            { id: 1, text: "Total charge of an isolated system remains constant. This is:", options: ["Quantization", "Conservation", "Additivity", "Induction"], correct: 1, topic: "Basics", explanation: "Conservation of charge states total charge of isolated system is constant." },
            { id: 2, text: "Dimensional formula of ε₀?", options: ["[M⁻¹L⁻³T⁴A²]", "[MLT⁻³A⁻¹]", "[M⁻¹L³T⁻⁴A⁻²]", "[ML³T⁻⁴A⁻²]"], correct: 0, topic: "Basics", explanation: "Derived from Coulomb's Law." },
            { id: 3, text: "Force between two charges if distance is tripled?", options: ["Becomes 9 times", "Becomes 3 times", "Becomes 1/9", "Becomes 1/3"], correct: 2, topic: "Coulomb's Law", explanation: "F ∝ 1/r². If r -> 3r, F -> F/9." },
            { id: 4, text: "Two electric field lines never cross because:", options: ["They are closed loops", "They repel", "Two directions at one point impossible", "None"], correct: 2, topic: "Electric Field", explanation: "Intersection implies two directions of field at one point." },
            { id: 5, text: "Max torque on dipole in uniform field at angle:", options: ["0°", "90°", "180°", "45°"], correct: 1, topic: "Dipole", explanation: "Torque = pE sinθ. Max at sin90° = 1." },
            { id: 6, text: "Direction of dipole moment?", options: ["-q to +q", "+q to -q", "Perpendicular", "Random"], correct: 0, topic: "Dipole", explanation: "By convention, from negative to positive charge." },
            { id: 7, text: "E_axial is how many times E_equatorial?", options: ["1", "2", "0.5", "4"], correct: 1, topic: "Dipole", explanation: "Axial = 2kp/r³, Equatorial = kp/r³." },
            { id: 8, text: "SI Unit of Electric Flux?", options: ["N/C", "V/m", "N m²/C", "N m/C"], correct: 2, topic: "Gauss Law", explanation: "Flux Φ = E.A = (N/C) * m²." },
            { id: 9, text: "Flux through a surface enclosing charge q?", options: ["q/ε₀", "qε₀", "Zero", "q/2ε₀"], correct: 0, topic: "Gauss Law", explanation: "Gauss's Law statement." },
            { id: 10, text: "Field inside a uniformly charged shell?", options: ["Zero", "Uniform", "Infinite", "Same as surface"], correct: 0, topic: "Gauss Law", explanation: "No charge enclosed inside the shell." },
            { id: 11, text: "Field due to infinite plane sheet depends on distance r as:", options: ["1/r", "1/r²", "Independent of r", "r"], correct: 2, topic: "Gauss Law", explanation: "E = σ/2ε₀. No 'r' term." },
            { id: 12, text: "Unit of Linear Charge Density λ?", options: ["C", "C/m", "C/m²", "C/m³"], correct: 1, topic: "Basics", explanation: "Charge per unit length." },
            { id: 13, text: "Value of k in vacuum?", options: ["9×10⁹", "8.85×10⁻¹²", "1.6×10⁻¹⁹", "Zero"], correct: 0, topic: "Coulomb's Law", explanation: "1/4πε₀ ≈ 9×10⁹." },
            { id: 14, text: "Ratio of electrostatic to gravitational force for electrons?", options: ["10¹⁰", "10³⁹", "10⁻¹⁰", "1"], correct: 1, topic: "Basics", explanation: "Electrostatic force is vastly stronger." },
            { id: 15, text: "Field due to line charge falls off as:", options: ["1/r", "1/r²", "1/r³", "Constant"], correct: 0, topic: "Gauss Law", explanation: "E = λ/2πε₀r." }
        ];

        const quizApp = {
            idx: 0, answers: Array(questions.length).fill(null), timer: 900, interval: null,

            start: function() {
                this.idx = 0; this.answers.fill(null); this.timer = 900;
                document.getElementById('screen-start').classList.add('hidden');
                document.getElementById('screen-result').classList.add('hidden');
                document.getElementById('screen-result').classList.remove('flex');
                const quizScreen = document.getElementById('screen-quiz');
                quizScreen.classList.remove('hidden');
                quizScreen.classList.add('flex');
                this.renderQ();
                this.startTimer();
            },

            startTimer: function() {
                clearInterval(this.interval);
                this.interval = setInterval(() => {
                    if(this.timer <= 0) { this.finish(); return; }
                    this.timer--;
                    const m = Math.floor(this.timer / 60);
                    const s = this.timer % 60;
                    document.getElementById('timer').innerText = `${m}:${s < 10 ? '0'+s : s}`;
                }, 1000);
            },

            renderQ: function() {
                const q = questions[this.idx];
                document.getElementById('q-idx').innerText = this.idx + 1;
                document.getElementById('q-text').innerText = q.text;
                const box = document.getElementById('options-box');
                box.innerHTML = '';
                const nextBtn = document.getElementById('btn-next');
                nextBtn.disabled = true;
                nextBtn.innerText = (this.idx === questions.length - 1) ? "Submit Quiz" : "Next Question";

                q.options.forEach((opt, i) => {
                    const div = document.createElement('div');
                    div.className = 'quiz-option';
                    div.innerHTML = `<div class="quiz-circle"></div><span class="text-slate-300 font-medium">${opt}</span>`;
                    div.onclick = () => this.select(i, div);
                    box.appendChild(div);
                });
            },

            select: function(optIdx, el) {
                this.answers[this.idx] = optIdx;
                document.querySelectorAll('.quiz-option').forEach(x => x.classList.remove('selected'));
                el.classList.add('selected');
                document.getElementById('btn-next').disabled = false;
            },

            next: function() {
                if(this.idx < questions.length - 1) { this.idx++; this.renderQ(); } 
                else { this.finish(); }
            },

            finish: function() {
                clearInterval(this.interval);
                let correctCount = 0;
                let topicStats = {};

                questions.forEach((q, i) => {
                    const isCorrect = (this.answers[i] === q.correct);
                    if(isCorrect) correctCount++;
                    if(!topicStats[q.topic]) topicStats[q.topic] = { total: 0, right: 0 };
                    topicStats[q.topic].total++;
                    if(isCorrect) topicStats[q.topic].right++;
                });

                document.getElementById('screen-quiz').classList.add('hidden');
                document.getElementById('screen-quiz').classList.remove('flex');
                const resultScreen = document.getElementById('screen-result');
                resultScreen.classList.remove('hidden');
                resultScreen.classList.add('flex');

                document.getElementById('score').innerText = correctCount;
                const pct = Math.round((correctCount / questions.length) * 100);
                document.getElementById('score-text').innerText = `${pct}% Accuracy`;
                const deg = (correctCount / questions.length) * 360;
                document.getElementById('chart-pie').style.background = `conic-gradient(#22c55e 0deg ${deg}deg, #ef4444 ${deg}deg 360deg)`;
                document.getElementById('pie-text').innerText = `${pct}%`;

                const barBox = document.getElementById('chart-bars');
                const graphBox = document.getElementById('topic-graph');
                barBox.innerHTML = '';
                graphBox.innerHTML = '';

                for (const [topic, data] of Object.entries(topicStats)) {
                    const topicPct = Math.round((data.right / data.total) * 100);
                    barBox.innerHTML += `
                        <div class="text-sm">
                            <div class="flex justify-between text-slate-400 mb-1">
                                <span class="font-medium text-white">${topic}</span>
                                <span>${data.right}/${data.total}</span>
                            </div>
                            <div class="bar-bg"><div class="bar-fill" style="width: ${topicPct}%"></div></div>
                        </div>`;
                    graphBox.innerHTML += `
                        <div class="graph-bar-group">
                            <div class="graph-bar" style="height: ${topicPct}%;">
                                <div class="graph-value">${topicPct}%</div>
                            </div>
                            <div class="graph-label">${topic}</div>
                        </div>`;
                }

                finishQuizInternal(); 

                const reviewBox = document.getElementById('review-box');
                reviewBox.innerHTML = '';
                questions.forEach((q, i) => {
                    const isRight = (this.answers[i] === q.correct);
                    reviewBox.innerHTML += `
                        <div class="p-4 rounded-xl border border-white/5 bg-[#1e293b] ${isRight ? 'border-l-4 border-l-green-500' : 'border-l-4 border-l-red-500'}">
                            <p class="font-bold text-white mb-2 text-base">Q${i+1}: ${q.text}</p>
                            <div class="text-sm mb-2"><span class="${isRight ? 'text-green-400' : 'text-red-400'}">Answer: ${this.answers[i]!==null?q.options[this.answers[i]]:'Skipped'}</span></div>
                            <div class="text-xs text-slate-400">${q.explanation}</div>
                        </div>`;
                });
            }
        };
    </script>
</body>
</html>